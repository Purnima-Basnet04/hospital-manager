<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="t" tagdir="/WEB-INF/tags" %>

<%
    // Check if user is already logged in
    String userRole = (String) session.getAttribute("userRole");
    if (userRole != null) {
        // Redirect to appropriate dashboard based on role
        if (userRole.equals("ADMIN")) {
            response.sendRedirect("dashboard-admin.jsp");
            return;
        } else if (userRole.equals("DOCTOR")) {
            response.sendRedirect("dashboard-doctor.jsp");
            return;
        } else if (userRole.equals("PATIENT")) {
            response.sendRedirect("dashboard-patient.jsp");
            return;
        }
    }
%>

<t:template>
    <jsp:attribute name="title">Login - LifeCare Medical Center</jsp:attribute>

    <jsp:attribute name="additionalJS">
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // Check if there's an error parameter in the URL
                const urlParams = new URLSearchParams(window.location.search);
                if (urlParams.has('error')) {
                    document.getElementById('errorMessage').style.display = 'block';
                }
            });
        </script>
    </jsp:attribute>

    <jsp:body>
            <section class="form-section animate-on-scroll">
                <h2>Login to Your Account</h2>

                <div id="errorMessage" class="error-message" style="display: <%= request.getParameter("error") != null ? "block" : "none" %>;">
                    Invalid username or password. Please try again.
                </div>

                <form action="login-handler.jsp" method="post" class="login-form" id="loginForm">
                    <div class="form-group">
                        <label for="username">Username:</label>
                        <input type="text" id="username" name="username" required>
                    </div>

                    <div class="form-group">
                        <label for="password">Password:</label>
                        <input type="password" id="password" name="password" required>
                        <small>Enter your secure password</small>
                    </div>

                    <div class="form-group">
                        <label for="role">Login As:</label>
                        <select id="role" name="role" required>
                            <option value="">Select Role</option>
                            <option value="ADMIN">Admin</option>
                            <option value="DOCTOR">Doctor</option>
                            <option value="PATIENT">Patient</option>
                        </select>
                    </div>

                    <div class="form-group text-center margin-top-lg">
                        <button type="submit" class="btn primary">Login</button>
                    </div>

                    <div class="form-links">
                        <p>Don't have an account? <a href="register.jsp">Register here</a></p>
                        <p><a href="forgot-password.jsp">Forgot Password?</a></p>
                    </div>
                </form>
            </section>
    </jsp:body>
</t:template>
